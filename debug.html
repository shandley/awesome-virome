<!DOCTYPE html>
<html>
<head>
    <title>Debug Dashboard Loading</title>
    <script>
        // Function to fetch and display JSON content
        async function fetchAndDisplayJSON(url, elementId) {
            try {
                const response = await fetch(url);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const data = await response.json();
                
                // Display the data
                document.getElementById(elementId).textContent = 
                    JSON.stringify(data, null, 2);
                
                // Log data information
                console.log(`Loaded ${url}:`);
                console.log(`- tools: ${data.tools ? data.tools.length : 'undefined'} items`);
                if (data.tools && data.tools.length > 0) {
                    console.log(`- First tool: ${data.tools[0].name}`);
                    console.log(`- First tool citations: ${JSON.stringify(data.tools[0].citations_by_year)}`);
                }
                console.log(`- categories: ${data.categories ? Object.keys(data.categories).length : 'undefined'} items`);
                console.log(`- total citations: ${data.citations ? data.citations.total : 'undefined'}`);
                console.log(`- citation years: ${data.citations && data.citations.by_year ? Object.keys(data.citations.by_year).join(', ') : 'undefined'}`);
                
                return data;
            } catch (error) {
                console.error(`Error fetching ${url}:`, error);
                document.getElementById(elementId).textContent = `Error: ${error.message}`;
                return null;
            }
        }

        // Check if the DOM structure matches what JS is looking for
        function checkDOMElements() {
            const elements = [
                'citationTrendsChart',
                'topCitedToolsChart'
            ];
            
            console.log("Checking DOM elements:");
            elements.forEach(id => {
                const element = document.getElementById(id);
                console.log(`- #${id}: ${element ? 'Found' : 'MISSING'}`);
            });
        }
        
        // Run diagnostics when the page loads
        window.addEventListener('DOMContentLoaded', async () => {
            console.log("Starting diagnostics...");
            
            // Check if Chart.js and vis-network.js are loaded
            console.log("Checking libraries:");
            console.log("- Chart.js:", typeof Chart !== 'undefined' ? 'Loaded' : 'MISSING');
            console.log("- vis-network:", typeof vis !== 'undefined' ? 'Loaded' : 'MISSING');
            
            // Load and check data
            const impactData = await fetchAndDisplayJSON('impact_data.json', 'impactData');
            window.impactData = impactData;
            
            // Check DOM structure
            checkDOMElements();
            
            console.log("Diagnostics complete. See results above and in the pre elements below.");
        });
    </script>
</head>
<body>
    <h1>Dashboard Debug Tool</h1>
    <p>This page tests loading and parsing of the dashboard data files and checks for common issues.</p>
    
    <h2>Impact Data (impact_data.json)</h2>
    <pre id="impactData" style="background: #f0f0f0; padding: 10px; overflow: auto; max-height: 400px;"></pre>
    
    <h2>Next Steps</h2>
    <ol>
        <li>Check the console for errors and messages</li>
        <li>Verify that impact_data.json has citation data</li>
        <li>Confirm that the DOM structure in dashboard.html matches what visualization.js expects</li>
    </ol>
    
    <p><strong>Instructions:</strong> Upload this file to your GitHub Pages site and open it to diagnose issues. Check the browser console (F12) for detailed logs.</p>
</body>
</html>