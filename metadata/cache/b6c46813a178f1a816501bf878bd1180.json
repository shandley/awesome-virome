{
  "cache_date": "2025-04-01T08:49:50.211474",
  "data": "# VirSorter\n\nSource code of the VirSorter App, available on CyVerse (https://de.iplantcollaborative.org/de/)\n\n### NOTE - VirSorter 2 is now available for early access/testing -> see https://github.com/jiarong/VirSorter2 ###\n\n# Publication\n\n* VirSorter: mining viral signal from microbial genomic data\n* https://peerj.com/articles/985/\n* PubMed 26038737\n\n# Result files\nThe main output files of VirSorter are:\n- VIRSorter_global-phage-signal.csv: Comma-separated table listing the viral predictions from VirSorter (one row per prediction)\n- Metrics_files/VIRSorter_affi-contigs.tab: Pipe(\"|\")-delimited table listing the annotation of all predicted ORFs in all contigs. Lines starting with a \">\" are \"headers\", i.e. information about the contig (contig name, number of genes, \"c\" for circular or \"l\" for linear). All other lines are information about the genes, with different columns as follows: Gene name, start, stop, length, strand, Hit in the virus protein cluster database, hit score, hit e-value, category of the virus protein cluster (see below), Hit in PFAM, hit score, hit e-value.\nThe categories of virus clusters represent the range of genomes in which this virus cluster was detected, i.e. 0: hallmark genes found in Caudovirales, 1: non-hallmark gene found in Caudovirales, 2: non-hallmarke gene found exclusively in virome(s), 3: hallmark gene not found in Caudovirales, 4: non-hallmark gene not found in Caudovirales\n- Predicted_viral_sequences/: fasta and genbank files of predicted viral sequences\n- Fasta_files/: intermediary files, including predicted proteins\n- Tab_files/: intermediary files, including results of the search agasint PFAM and the virus database.\n\nVirSorter results can be imported into [Anvi'o](http://merenlab.org/software/anvio/) by following [these instructions](http://merenlab.org/2018/02/08/importing-virsorter-annotations/).\n\nVirSorter results can also be imported into R by following [these instructions](https://github.com/simroux/VirSorter/issues/37#issuecomment-475740536).\n\n# Using a conda virtual environment (tested on Ubuntu and CentOS)\n* First install [Anaconda or Miniconda](https://conda.io/docs/user-guide/install/index.html)\n* Download the databases required by VirSorter which have been converted to be used with HMMER version 3.1b2. Change to the directory where you want the databases be, and then run the following commands:\n```\nwget https://zenodo.org/record/1168727/files/virsorter-data-v2.tar.gz\nmd5sum virsorter-data-v2.tar.gz\n# md5sum should return dd12af7d13da0a85df0a9106e9346b45\ntar -xvzf virsorter-data-v2.tar.gz\n```\n* Create and install your conda virtual environment. Change to the directory where you want VirSorter to be installed and run the following commands:\n```\nconda create --name virsorter -c bioconda mcl=14.137 muscle blast perl-bioperl perl-file-which hmmer=3.1b2 perl-parallel-forkmanager perl-list-moreutils diamond=0.9.14\ngit clone https://github.com/simroux/VirSorter.git\ncd VirSorter/Scripts\nmake clean\nmake\n```\n* To run VirSorter from any directory, you can make symbolic links to `VirSorter/wrapper_phage_contigs_sorter_iPlant.pl` and `VirSorter/Scripts` and place them in the `bin` folder for your \"virsorter\" conda environment. An example location of this `bin` folder is `~/miniconda/envs/virsorter/bin`. Substitute this path with the path to the `bin` folder for your newly created \"virsorter\" environment.\n```\nln -s ~/Applications/VirSorter/wrapper_phage_contigs_sorter_iPlant.pl ~/miniconda/envs/virsorter/bin\nln -s ~/Applications/VirSorter/Scripts ~/miniconda/envs/virsorter/bin\n```\n* Finally, you'll need to download MetaGeneAnnotator ([Noguchi et al, 2006](https://doi.org/10.1093/nar/gkl723)). You can put this directly in the \"virsorter\" environment's `bin` folder alongside the VirSorter symbolic links taht were just created.\n```\ncd ~/miniconda/envs/virsorter/bin\nwget http://metagene.nig.ac.jp/metagene/mga_x86_64.tar.gz\ntar -xvzf mga_x86_64.tar.gz\n```\nAlternatively, you can install MetaGeneAnnotator in the conda environment as follows (thxs Simone Pignotti for the tip !):\n```\nconda install --name virsorter -c bioconda metagene_annotator\n```\n\nTo run VirSorter, type the following:\n\n```\nsource activate virsorter\nwrapper_phage_contigs_sorter_iPlant.pl -f assembly.fasta --db 1 --wdir output_directory --ncpu 4 --data-dir /path/to/virsorter-data\n```\n\n* Note: An option \"--no_c\" is available for cases where VirSorter result file is empty (0 virus sequences predicted) due to errors in compiling or running the C script used to calculate enrichment statistics. With the \"--no_c\" option, VirSorter will use a perl function instead, which is slower, but should work on most systems and architectures.\n* Note: if the folder provided as \"--wdir\" already exists, VirSorter will assume it derives from a (previously computed) successful run where gene prediction results are available. If this is not the case, VirSorter will throws an error: \"Step 1 failed\". In this case, simply delete the \"--wdir\" folder or change the parameter to a new folder name.\n\n\n# Note for Conda installation\nIf error: \"ListUtil.c: loadable library and perl binaries are mismatched\", this is a known conda issue, that can be fixed with the following steps:\nCreate a file etc/conda/activate.d/update_perllib.sh in your conda environment folder including the following lines:\n```\n#!/bin/sh\nexport OLD_PERL5LIB=$PERL5LIB\nexport PERL5LIB=`pwd`/../../../lib/site_perl/5.26.2/\n```\nThen create a file etc/conda/deactivate.d/update_perllib.sh in your conda environment folder including the following lines:\n```\n#!/bin/sh\nexport PERL5LIB=$OLD_PERL5LIB\n```\nNote: you may have to create the folders \"etc\", \"etc/conda\", \"etc/conda/activate.d/\", and \"etc/conda/deactivate.d/\" (e.g. using mkdir) in your conda environment folder, as these are not always generated by default in every conda environment.\n\n# Note for Diamond\nFor users trying to use the \"diamond\" option, please verify that you download the latest version of the \"data-dir\" package (wget https://zenodo.org/record/1168727/files/virsorter-data-v2.tar.gz), as previous versions of the database did not include the diamond database file.\n\n# Docker - from DockerHub (v1.0.5)\n\n* Download the databases required by VirSorter which have been converted to be used with HMMER version 3.1b2. Change to the directory where you want the databases be, and then run the following commands:\n```\nwget https://zenodo.org/record/1168727/files/virsorter-data-v2.tar.gz\nmd5sum virsorter-data-v2.tar.gz\n#m5sum should return dd12af7d13da0a85df0a9106e9346b45\ntar -xvzf virsorter-data-v2.tar.gz\n```\n* Pull VirSorter 1.0.5 from dockerhub: $ docker pull simroux/virsorter:v1.0.5\n* Then run VirSorter from docker, mounting the data directory as data, and the run directory as wdir:\n```\n    $ docker run -v /host/path/to/virsorter-data:/data -v /host/path/to/virsorter-run:/wdir -w /wdir --rm simroux/virsorter:v1.0.5 --db 2 --fna Input_contigs.fna\n\n```\nAfter \"virsorter:v1.0.5\", the options correspond to the ones described in wrapper_phage_contigs_sorter_iPlant.pl (here selecting the database \"Viromes\" and pointing VirSorter to the file \"Input_contigs.fna\").\n* You can specify a userID to be the owner of the files that will be created by VirSorter by using the --user option of Docker, e.g.\n```\n    $ docker run --user `id -u` -v /host/path/to/virsorter-data:/data -v /host/path/to/virsorter-run:/wdir -w /wdir --rm simroux/virsorter:v1.0.5 --db 2 --fna Input_contigs.fna\n\n```\n\n# Docker - from DockerHub (v1.0.3)\n\n* Download the databases required by VirSorter, available as a tarball archive on iMicrobe: http://mirrors.iplantcollaborative.org/browse/iplant/home/shared/imicrobe/VirSorter/virsorter-data.tar.gz\nor /iplant/home/shared/imicrobe/VirSorter/virsorter-data.tar.gz through iPlant Discovery Environment\n* Untar this package in a directory, e.g. /host/path/to/virsorter-data\n* Pull VirSorter from dockerhub: $ docker pull discoenv/virsorter:v1.0.3\n* Create a working directory for VirSorter which includes the input fasta file, e.g. /host/path/to/virsorter-run\n* Then run VirSorter from docker, mounting the data directory as data, and the run directory as wdir:\n\n    $ docker run -v /host/path/to/virsorter-data:/data -v /host/path/to/virsorter-run:/wdir -w /wdir --rm discoenv/virsorter:v1.0.3 --db 2 --fna /wdir/Input_contigs.fna\n\nAfter \"virsorter:v1.0.3\", the options correspond to the ones described in wrapper_phage_contigs_sorter_iPlant.pl (here selecting the database \"Viromes\" and pointing VirSorter to the file \"Input_contigs.fna\").\n\n\n# Docker - building packages from scratch\n\n\n## Dependencies\n\nInstall the following into a \"bin\" directory:\n\n* HMMER (http://hmmer.janelia.org/)\n* MCL (http://micans.org/mcl/)\n* Metagene Annotator (http://metagene.nig.ac.jp/metagene/download_mga.html)\n* MUSCLE (http://www.drive5.com/muscle/)\n* BLAST+ (ftp://ftp.ncbi.nlm.nih.gov/blast/executables/blast+/LATEST/)\n* DIAMOND (https://github.com/bbuchfink/diamond)\n\n## Data Container\n\nThe 12G of dependent data exists as a separate data container \ncalled \"virsorter-data.\"\n\nThis is the Dockerfile for that:\n\n    FROM perl:latest\n\n    MAINTAINER Ken Youens-Clark <kyclark@email.arizona.edu>\n\n    COPY Generic_ref_file.refs /data/\n\n    COPY PFAM_27 /data/PFAM_27\n\n    COPY Phage_gene_catalog /data/Phage_gene_catalog\n\n    COPY Phage_gene_catalog_plus_viromes /data/Phage_gene_catalog_plus_viromes\n\n    COPY VirSorter_Readme.txt /data\n\n    COPY VirSorter_Readme_viromes.txt /data\n\n    VOLUME [\"/data\"]\n  \nThen do:\n\n    $ docker build -t kyclark/virsorter-data .\n    $ docker create --name virsorter-data kyclark/virsorter-data /bin/true\n\n## Build\n\n    $ docker build -t kyclark/virsorter .\n\n## Run\n\nA sample \"run\" command to use the current working directory for input/output:\n\n    $ docker run --rm --volumes-from virsorter-data -v $(pwd):/de-app-work \\\n    -w /de-app-work kyclark/virsorter --fna Mic_1.fna --db 1\n\n# Authors\n\nSimon Roux <sroux@lbl.gov> is the author of Virsorter\n\nKen Youens-Clark <kyclark@email.arizona.edu> packaged this for Docker/iPlant.\n\nBryan D Merrill <bmerrill@stanford.edu> provided the improvements and additions for v1.0.5\n"
}