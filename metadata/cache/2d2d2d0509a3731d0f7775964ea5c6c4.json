{
  "cache_date": "2025-03-17T02:10:43.393215",
  "data": "[![Anaconda-Server Badge](https://anaconda.org/fkretschmer/bertax/badges/version.svg)](https://anaconda.org/fkretschmer/bertax)\n\n# BERTax: Taxonomic Classification of DNA sequences\n\nThis is the repository to the preprint-paper [BERTax: taxonomic classification of DNA sequences with Deep Neural Networks](https://www.biorxiv.org/content/10.1101/2021.07.09.451778v1) and the published paper: [Taxonomic classification of DNA sequences beyond sequence similarity using deep neural networks](https://doi.org/10.1073/pnas.2122636119) respectively.\n\nThe used data can be found under DOI 10.17605/OSF.IO/QG6MV or [https://osf.io/qg6mv/](https://osf.io/qg6mv/)\n\n## Run Bertax\n\nWe provide a Docker container to run BERTax.\nPull and run with:\n```shell\ndocker run -t --rm -v /path/to/input/files:/in fkre/bertax:latest /in/sequences.fa\n```\n\nThe docker container can also be run with GPU-support, likely resulting in much faster predictions. For this, the `nvidia-container-toolkit` has to be [installed](https://docs.nvidia.com/datacenter/cloud-native/container-toolkit/install-guide.html#docker), the `bertax` image has to be run with the flag `--gpus all`.\n\nThe image can be built locally (after cloning -- see below) with\n```shell\ndocker build -t bertax bertax\n```\n\n\n## Alternative local installation\n### Prepare conda\n\nInstall in new conda environment\n```shell\nconda create -n bertax -c fkretschmer bertax\n```\n\nActivate environment and install necessary pip-dependencies\n```shell\nconda activate bertax\npip install keras-bert==0.86.0\n```\n\n### Local pip-only installation\n\n\nFirst clone this repository\n```shell\ngit clone https://github.com/rnajena/bertax.git\n```\n\nThen [download](https://github.com/rnajena/bertax/releases/latest/download/big_trainingset_all_fix_classes_selection.h5) the (big) model file into the `resources` subfolder.\n\nFinally, install with pip\n```shell\npip install -e bertax\n```\n\n## Usage\n\nThe script takes a (multi)fasta as input and outputs a list of predicted classes to the console:\n```shell\nbertax sequences.fasta\n```\n\nOptions:\n<table>\n<thead><tr><th>parameter</th><th>explanation</th></tr></thead>\n<tbody>\n<tr><td><code>-o</code> <code>--output_file</code></td><td>write output to specified file (tab-separated format) instead of to the output stream (console)</td></tr>\n<tr><td><code>--conf_matrix_file</code></td><td>output confidences for all classes of all ranks to JSON file</td></tr>\n<tr><td><code>--sequence_split</code></td><td>how to handle sequences sequence longer than the maximum (window) size: split into equal chunks (<code>equal_chunks</code>, default) or use random sequence window (<code>window</code>)</td></tr>\n<tr><td><code>-C</code> <code>--maximum_sequence_chunks</code></td><td>maximum number of chunks to use per (long) sequence</td></tr>\n<tr><td><code>--running_window</code></td><td>if enabled, a running window approach is chosen to go over each sequence to make predictions</td></tr>\n<tr><td><code>--running_window_stride</code></td><td>stride for running window (default: 1)</td></tr>\n<tr><td><code>--custom_window_size</code></td><td>allows specifying a custom, smaller window size</td></tr>\n<tr><td><code>--chunk_predictions</code></td><td>output predictions per chunk, otherwise (by default) chunk predictions are averaged</td></tr>\n<tr><td><code>--output_ranks</code></td><td>specify which ranks to include in output (default: superkingdom phylum genus)</td></tr>\n<tr><td><code>--no_confidence</code></td><td>if set, do not include confidence scores in output</td></tr>\n<tr><td><code>--batch_size</code></td><td>batch size (i.e., how many sequence chunks to predict at the same time); can be lowered to decrease memory usage and increased for better performance (default: 32)</td></tr>\n<tr><td><code>-t</code> <code>--nr_threads</code></td><td>set the number of threads used (default: determine automatically)</td></tr>\n</tbody>\n</table>\n\nNote, that \"unknown\" is a special placeholder class for each prediction rank, meaning the sequence's taxonomy is predicted to be unlike any possible output class.\n\n### Examples\n\nDefault mode, sequences longer than 1500 nt are split into equal chunks, one prediction (average) per sequence\n```shell\nbertax sequences.fa\n```\n\nOnly use one random chunk per sequence (for sequences longer than 1500 nt)\n```shell\nbertax --sequence_split window sequences.fa\n```\n\nOnly output the superkingdom\n\n```shell\nbertax sequences.fa --output_ranks superkingdom\n```\n\nPredict with a running window in 300 nt steps and output predictions for all chunks (no threshold for the number of chunks per sequence)\n\n```shell\nbertax -C -1 --running_window --running_window_stride 300 --chunk_predictions sequences.fa\n```\n\n### Confusion Matrices\n\nIn the directory [confusion_matrices](confusion_matrices/) you can find confusion matrices from the publication's results which indicate the classification quality. These matrices could not be included directly in the paper due to the vast amount and size of them.\n\n## Visualization\n\nIt is possible to get a visualization of the underlying BERT model, based on\n[bertviz](https://github.com/jessevig/bertviz) for a specific DNA sequence. For this,\nadditional dependencies have to be installed:\n\n- torch\n- transformers\n- bertviz==1.0.0\n\nAn HTML file with interactive visualization can be created with:\n\n```shell\nbertax-visualize sequence.fa\n```\n\nAs visualization is quite performance-intensive for big sequences, parameters can be set\nto only visualize a specific part (`-a $start -n $size`). Both an attention-head view and\nmodel-view are available, set with the parameter `--mode {head|model}`.\n\n## Training BERTax models\n\nThe repository with the code used in the development of BERTax is located at https://github.com/rnajena/bertax_training.\nCustom models trained with these scripts can be used in BERTax with the parameter `--custom_model_file`.\n\n## Compatible phyla and genera\n\nDue to the limited amount of samples that can be used for training, we could not train all known phyla and genera. Therefore, we present here the list of compatible phyla and genera. Note: If the taxon of your sample is not included in this list, there is a high probability that phylum/genus will be predicted as \"unknown\".\nIf you want you can [train your own model](#training-bertax-models), that includes the taxa of interest to you.\n\nNote: We recommend using BERTax only for super kingdom and phylum prediction, but genera are possible. For more details see: [our paper at pnas.org](https://www.pnas.org/doi/full/10.1073/pnas.2122636119)\n\n**phylum**\n\n    'Actinobacteria', 'Apicomplexa', 'Aquificae',\n    'Arthropoda', 'Artverviricota', 'Ascomycota', 'Bacillariophyta', 'Bacteroidetes',\n    'Basidiomycota', 'Candidatus Thermoplasmatota', 'Chlamydiae', 'Chlorobi',\n    'Chloroflexi', 'Chlorophyta', 'Chordata', 'Crenarchaeota', 'Cyanobacteria',\n    'Deinococcus-Thermus', 'Euglenozoa', 'Euryarchaeota', 'Evosea', 'Firmicutes',\n    'Fusobacteria', 'Gemmatimonadetes', 'Kitrinoviricota', 'Lentisphaerae', 'Mollusca',\n    'Negarnaviricota', 'Nematoda', 'Nitrospirae', 'Peploviricota', 'Pisuviricota',\n    'Planctomycetes', 'Platyhelminthes', 'Proteobacteria', 'Rhodophyta', 'Spirochaetes',\n    'Streptophyta', 'Tenericutes', 'Thaumarchaeota', 'Thermotogae', 'Uroviricota',\n    'Verrucomicrobia'\n\n**genus**\n\n    'Acidilobus', 'Acidithiobacillus',\n    'Actinomyces', 'Actinopolyspora', 'Acyrthosiphon', 'Aeromonas', 'Akkermansia', 'Anas',\n    'Apis', 'Aquila', 'Archaeoglobus', 'Asparagus', 'Aspergillus', 'Astyanax', 'Aythya',\n    'Bdellovibrio', 'Beta', 'Betta', 'Bifidobacterium', 'Botrytis', 'Brachyspira',\n    'Bradymonas', 'Brassica', 'Caenorhabditis', 'Calypte', 'Candidatus Kuenenia',\n    'Candidatus Nitrosocaldus', 'Candidatus Promineofilum', 'Carassius', 'Cercospora',\n    'Chanos', 'Chlamydia', 'Chrysemys', 'Ciona', 'Citrus', 'Clupea', 'Coffea',\n    'Colletotrichum', 'Cottoperca', 'Crassostrea', 'Cryptococcus', 'Cucumis', 'Cucurbita',\n    'Cyanidioschyzon', 'Cynara', 'Cynoglossus', 'Daucus', 'Deinococcus', 'Denticeps',\n    'Desulfovibrio', 'Dictyostelium', 'Drosophila', 'Echeneis', 'Egibacter', 'Egicoccus',\n    'Elaeis', 'Equus', 'Erpetoichthys', 'Esox', 'Euzebya', 'Fervidicoccus', 'Frankia',\n    'Fusarium', 'Gadus', 'Gallus', 'Gemmata', 'Gopherus', 'Gossypium', 'Gouania',\n    'Helianthus', 'Ictalurus', 'Ktedonosporobacter', 'Legionella', 'Leishmania',\n    'Lepisosteus', 'Leptospira', 'Limnochorda', 'Malassezia', 'Manihot', 'Mariprofundus',\n    'Methanobacterium', 'Methanobrevibacter', 'Methanocaldococcus', 'Methanocella',\n    'Methanopyrus', 'Methanosarcina', 'Microcaecilia', 'Modestobacter', 'Monodelphis',\n    'Mus', 'Musa', 'Myripristis', 'Neisseria', 'Nitrosopumilus', 'Nitrososphaera',\n    'Nitrospira', 'Nymphaea', 'Octopus', 'Olea', 'Oncorhynchus', 'Ooceraea',\n    'Ornithorhynchus', 'Oryctolagus', 'Oryzias', 'Ostreococcus', 'Papaver', 'Perca',\n    'Phaeodactylum', 'Phyllostomus', 'Physcomitrium', 'Plasmodium', 'Podarcis', 'Pomacea',\n    'Populus', 'Prosthecochloris', 'Pseudomonas', 'Punica', 'Pyricularia', 'Pyrobaculum',\n    'Quercus', 'Rhinatrema', 'Rhopalosiphum', 'Roseiflexus', 'Rubrobacter', 'Rudivirus',\n    'Salarias', 'Salinisphaera', 'Sarcophilus', 'Schistosoma', 'Scleropages',\n    'Sedimentisphaera', 'Sesamum', 'Solanum', 'Sparus', 'Sphaeramia', 'Spodoptera',\n    'Sporisorium', 'Stanieria', 'Streptomyces', 'Strigops', 'Synechococcus', 'Takifugu',\n    'Thalassiosira', 'Theileria', 'Thermococcus', 'Thermogutta', 'Thermus', 'Tribolium',\n    'Trichoplusia', 'Ustilago', 'Vibrio', 'Vitis', 'Xenopus', 'Xiphophorus',\n    'Zymoseptoria'\n"
}